{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "fy",
  "scopeName": "source.fy",
  "patterns": [
    { "include": "#comment" },
    { "include": "#shebang" },
    { "include": "#string" },
    { "include": "#char-literal" },
    { "include": "#struct-definition" },
    { "include": "#constant-definition" },
    { "include": "#word-definition" },
    { "include": "#locals" },
    { "include": "#number-float" },
    { "include": "#number-integer" },
    { "include": "#semicolon" },
    { "include": "#brackets" },
    { "include": "#directives" },
    { "include": "#flow-control" },
    { "include": "#operators" },
    { "include": "#stack-ops" },
    { "include": "#float-ops" },
    { "include": "#memory-ops" },
    { "include": "#ffi-words" },
    { "include": "#io-words" },
    { "include": "#quote-ops" },
    { "include": "#type-check" },
    { "include": "#rstack" },
    { "include": "#namespaced-call" }
  ],
  "repository": {
    "comment": {
      "name": "comment.block.fy",
      "begin": "\\(",
      "end": "\\)",
      "patterns": [
        { "include": "#comment" }
      ]
    },
    "shebang": {
      "name": "comment.line.shebang.fy",
      "match": "\\A#!.*$"
    },
    "string": {
      "name": "string.quoted.double.fy",
      "begin": "\"",
      "end": "\"",
      "patterns": [
        {
          "name": "constant.character.escape.fy",
          "match": "\\\\."
        }
      ]
    },
    "char-literal": {
      "name": "constant.character.fy",
      "match": "'[^\\s]"
    },
    "struct-definition": {
      "name": "meta.struct.fy",
      "begin": "(struct:)\\s+([^\\s;]+)",
      "end": "(;)",
      "beginCaptures": {
        "1": { "name": "keyword.control.struct.fy" },
        "2": { "name": "entity.name.type.struct.fy" }
      },
      "endCaptures": {
        "1": { "name": "keyword.control.end.fy" }
      },
      "patterns": [
        { "include": "#comment" },
        {
          "name": "storage.type.field.fy",
          "match": "(?<=\\s|^)(i8|u8|i16|u16|i32|u32|i64|u64|f32|f64|ptr)(?=\\s|$)"
        },
        {
          "name": "variable.other.field.fy",
          "match": "[^\\s;]+"
        }
      ]
    },
    "constant-definition": {
      "match": "(::)\\s+([^\\s;]+)",
      "captures": {
        "1": { "name": "keyword.control.constant.fy" },
        "2": { "name": "entity.name.function.constant.fy" }
      }
    },
    "word-definition": {
      "match": "(:)\\s+([^\\s;]+)",
      "captures": {
        "1": { "name": "keyword.control.definition.fy" },
        "2": { "name": "entity.name.function.fy" }
      }
    },
    "locals": {
      "name": "meta.locals.fy",
      "begin": "(?<=\\[)\\s*(\\|)",
      "end": "(\\|)",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.locals.begin.fy" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.locals.end.fy" }
      },
      "patterns": [
        {
          "name": "variable.parameter.fy",
          "match": "[^\\s|]+"
        }
      ]
    },
    "number-float": {
      "name": "constant.numeric.float.fy",
      "match": "(?<=\\s|^)-?\\d+\\.\\d+(?=\\s|$|;|\\]|\\))"
    },
    "number-integer": {
      "name": "constant.numeric.integer.fy",
      "match": "(?<=\\s|^)-?\\d+(?=\\s|$|;|\\]|\\))"
    },
    "semicolon": {
      "name": "keyword.control.end.fy",
      "match": ";"
    },
    "brackets": {
      "patterns": [
        {
          "name": "punctuation.section.brackets.begin.fy",
          "match": "\\["
        },
        {
          "name": "punctuation.section.brackets.end.fy",
          "match": "\\]"
        }
      ]
    },
    "directives": {
      "name": "keyword.other.directive.fy",
      "match": "(?<=\\s|^)(bind:|sig:|include|import)(?=\\s|$)"
    },
    "flow-control": {
      "name": "keyword.control.flow.fy",
      "match": "(?<=\\s|^)(ifte|do\\?|do|times|dotimes|repeat|recur|not|dip)(?=\\s|$|;|\\])"
    },
    "operators": {
      "name": "keyword.operator.fy",
      "match": "(?<=\\s|^)(\\+|\\!-|-|\\*|/|<=|>=|!=|=|<|>|&|or|xor|<<|>>|1\\+|1-)(?=\\s|$|;|\\])"
    },
    "stack-ops": {
      "name": "support.function.stack.fy",
      "match": "(?<=\\s|^)(dup2|dup|swap|drop2|drop|over2|over|nip|tuck|rot|-rot|depth)(?=\\s|$|;|\\])"
    },
    "float-ops": {
      "name": "support.function.float.fy",
      "match": "(?<=\\s|^)(f\\+|f-|f\\*|f/|f<|f>|f=|fneg|f\\.|i>f|f>i)(?=\\s|$|;|\\])"
    },
    "memory-ops": {
      "name": "support.function.memory.fy",
      "match": "(?<=\\s|^)(alloc|free|!32|f!32|@32)(?=\\s|$|;|\\])"
    },
    "ffi-words": {
      "name": "support.function.ffi.fy",
      "match": "(?<=\\s|^)(dl-open|dl-sym|dl-close|cstr-new|cstr-free|with-cstr-q|with-cstr-f|with-cstr|ccall[0-3]|ccall1pac)(?=\\s|$|;|\\])"
    },
    "io-words": {
      "name": "support.function.io.fy",
      "match": "(?<=\\s|^)(\\.hex|\\.dbg|\\.nl|\\.c|\\.|spy|s\\+|slen|s\\.|slurp|spit|readln|gc)(?=\\s|$|;|\\])"
    },
    "quote-ops": {
      "name": "support.function.quote.fy",
      "match": "(?<=\\s|^)(cat|qcat|qlen|qempty\\?|qhead|qtail|qpush|qnil|map|reduce)(?=\\s|$|;|\\])"
    },
    "type-check": {
      "name": "support.function.typecheck.fy",
      "match": "(?<=\\s|^)(int\\?|string\\?)(?=\\s|$|;|\\])"
    },
    "rstack": {
      "name": "support.function.rstack.fy",
      "match": "(?<=\\s|^)(>r|r>|r@)(?=\\s|$|;|\\])"
    },
    "namespaced-call": {
      "match": "([a-zA-Z_][a-zA-Z0-9_-]*)(:)([a-zA-Z_][a-zA-Z0-9_-]*)",
      "captures": {
        "1": { "name": "entity.name.namespace.fy" },
        "2": { "name": "punctuation.separator.namespace.fy" },
        "3": { "name": "entity.name.function.call.fy" }
      }
    }
  }
}
